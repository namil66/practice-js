<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <title>GitHub ì¸ì¦ ì‹¤ìŠµ</title>
  </head>
  <body>
    <h1>ğŸ“¦ ë‚´ GitHub ì €ì¥ì†Œ ëª©ë¡ ë³´ê¸°</h1>
    <form>
      <label for="github-personal-access-token">GitHub ê°œì¸ ì—‘ì„¸ìŠ¤ í† í°</label>
      <input
        type="text"
        id="github-personal-access-token"
        placeholder="GitHub ê°œì¸ ì—‘ì„¸ìŠ¤ í† í° ì…ë ¥"
        size="60"
      />
      <button type="submit">ê°€ì ¸ì˜¤ê¸°</button>
    </form>
    <ul data-id="repoList"></ul>

    <script>
      const COUNT_PER_PAGE = 3;
      const GITHUB_ENDPOINT = "https://api.github.com/user/repos";
      // const GITHUB_ENDPOINT = 'https://api.github.com/users/yamoo9/repos'
      const repoList = document.querySelector('[data-id="repoList"]');
      const errorPrint = document.querySelector('[role="alert"]');
      const form = document.querySelector("form");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const form = e.currentTarget;
        const [tokenInput] = form.elements;
        const token = tokenInput.value.trim();
        // console.log(token)

        fetchGitHubUserRepos(token)
          // .then((data) => {
          //   console.log(data)
          //   // renderRepos(data)
          // })
          .then(renderRepos)
          .catch(renderError);

        form.reset();
      });

      function fetchGitHubUserRepos(token) {
        // return fetch(GITHUB_ENDPOINT, {
        //   method: 'POST',
        console.log(token);

        return (
          fetch(`${GITHUB_ENDPOINT}?per_page=${COUNT_PER_PAGE}`, {
            method: "GET",
            headers: { Authorization: `Bearer ${token}` },
          })
            // .then((response) => response.json())
            // .catch(console.error)
            // ì˜¤ë¥˜ ì²˜ë¦¬ (ì§ì ‘)
            .then((response) =>
              response.json().then((data) => {
                // ì´í–‰ëœ ê²½ìš°
                if (response.ok) return data;
                // ê±°ì ˆëœ ê²½ìš°
                // 1. return Promise.reject(new Error('error message'))
                return Promise.reject(new Error(data.message));
                // 2. throw new Error('error message')
              })
            )
        );
      }

      // DOM ì—…ë°ì´íŠ¸
      // ì´í–‰ëœ ê²½ìš°
      function renderRepos(data) {
        // console.log(repoList, data)
        // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        // console.log('render repos')

        // ìˆœí™˜í•´ì„œ ìš”ì†Œ ìƒì„± ì¶”ê°€
        const fragment = document.createDocumentFragment();
        fragment.append(document.createElement("div"));

        data.forEach(({ description }) => {
          const item = document.createElement("li");
          item.textContent = description;
          fragment.firstElementChild.append(item);
        });

        repoList.innerHTML = fragment.firstElementChild.innerHTML;
      }
      // ê±°ì ˆëœ ê²½ìš°
      function renderError(error) {
        // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ ë Œë”ë§ (ì•ˆë‚´)
        console.log("render error");
        console.log(error.message);

        errorPrint.textContent = error.message;
        errorPrint.hidden = false;
        errorPrint.style.cssText = `
               color: red;
               font-weight: 900;
             `;
      }
    </script>
  </body>
</html>
